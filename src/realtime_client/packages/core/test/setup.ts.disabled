/**
 * Test setup for @agentc/realtime-core package
 */

import { afterEach, vi } from 'vitest';

// Setup basic mocks
if (typeof global !== 'undefined') {
  // Mock WebSocket if not available
  if (!global.WebSocket) {
    (global as any).WebSocket = vi.fn().mockImplementation(() => ({
      send: vi.fn(),
      close: vi.fn(),
      addEventListener: vi.fn(),
      removeEventListener: vi.fn(),
      readyState: 0,
      CONNECTING: 0,
      OPEN: 1,
      CLOSING: 2,
      CLOSED: 3,
    }));
  }

  // Mock AudioContext if not available
  if (!global.AudioContext) {
    (global as any).AudioContext = vi.fn().mockImplementation(() => ({
      createGain: vi.fn(() => ({
        gain: { value: 1 },
        connect: vi.fn(),
        disconnect: vi.fn(),
      })),
      sampleRate: 48000,
      currentTime: 0,
      state: 'running',
      suspend: vi.fn(),
      resume: vi.fn(),
      close: vi.fn(),
    }));
  }

  // Mock fetch if not available
  if (!global.fetch) {
    (global as any).fetch = vi.fn();
  }
}

// Clean up after each test
afterEach(() => {
  vi.clearAllMocks();
});